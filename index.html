<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Escape The Upside Down</title>
<style>
body { margin:0; background:black; color:white; text-align:center; }
canvas { background:#0a0a0a; display:block; margin:auto; image-rendering:pixelated; border:4px solid red; }
h1 { color:red; text-shadow:0 0 10px red; }
</style>
</head>
<body>

<h1>ESCAPE THE UPSIDE DOWN</h1>
<canvas id="game" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TILE = 40;

const map = [
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
[1,0,1,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1],
[1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1],
[1,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,1],
[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1],
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let player = { x: TILE*1, y: TILE*1, size: 28, speed:3 };
let demo = { x: TILE*18, y: TILE*5, size:28, speed:1.5 };

let keys = {};
let lights = [];
let gameOver = false;
let win = false;

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function spawnLights(){
for(let i=0;i<6;i++){
let x,y;
do{
x = Math.floor(Math.random()*18)+1;
y = Math.floor(Math.random()*5)+1;
}while(map[y][x]!==0);

lights.push({x:x*TILE+10,y:y*TILE+10,size:10});
}
}
spawnLights();

function canMove(nx, ny){
let col = Math.floor(nx/TILE);
let row = Math.floor(ny/TILE);
return map[row][col]!==1;
}

function update(){

if(gameOver||win) return;

if(keys["w"] && canMove(player.x,player.y-player.speed)) player.y-=player.speed;
if(keys["s"] && canMove(player.x,player.y+player.speed)) player.y+=player.speed;
if(keys["a"] && canMove(player.x-player.speed,player.y)) player.x-=player.speed;
if(keys["d"] && canMove(player.x+player.speed,player.y)) player.x+=player.speed;

let dx = player.x - demo.x;
let dy = player.y - demo.y;
let dist = Math.sqrt(dx*dx+dy*dy);
demo.x += (dx/dist)*demo.speed;
demo.y += (dy/dist)*demo.speed;

lights.forEach((light,i)=>{
if(Math.abs(player.x-light.x)<20 && Math.abs(player.y-light.y)<20){
lights.splice(i,1);
}
});

if(Math.abs(player.x-demo.x)<25 && Math.abs(player.y-demo.y)<25){
gameOver = true;
}

if(lights.length===0){
win = true;
}
}

function drawMap(){
for(let r=0;r<map.length;r++){
for(let c=0;c<map[r].length;c++){
ctx.fillStyle = map[r][c]===1 ? "#333" : "#111";
ctx.fillRect(c*TILE,r*TILE,TILE,TILE);
}
}
}

function drawLights(){
ctx.fillStyle="yellow";
lights.forEach(l=>{
ctx.fillRect(l.x,l.y,l.size,l.size);
});
}

function drawPlayer(){
ctx.fillStyle="cyan";
ctx.fillRect(player.x,player.y,player.size,player.size);
}

function drawDemo(){
ctx.fillStyle="purple";
ctx.fillRect(demo.x,demo.y,demo.size,demo.size);
}

function drawUI(){
ctx.fillStyle="white";
ctx.fillText("Lights Left: "+lights.length,10,20);

if(gameOver){
ctx.fillStyle="red";
ctx.font="40px monospace";
ctx.fillText("THE DEMOGORGON GOT YOU",180,250);
}
if(win){
ctx.fillStyle="lime";
ctx.font="40px monospace";
ctx.fillText("YOU ESCAPED!",280,250);
}
}

function loop(){
ctx.clearRect(0,0,canvas.width,canvas.height);
update();
drawMap();
drawLights();
drawPlayer();
drawDemo();
drawUI();
requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
